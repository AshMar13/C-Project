#include <iostream>
#include <string>
#include <iomanip>
using namespace std;

class Actuator {
protected:
    string state = "OFF";
    float power = 0.0;
    float energy_used = 0.0;
    float cycles = 0.0;
    float on_time = 0.0;

public:
    void simulate1Hr() {
        if (state == "ON") {
            energy_used += power;
            on_time += 1.0;
            cycles += 0.5;
        }
    }

    void turnOn(float pwr) {
        state = "ON";
        power = pwr;
    }

    void turnOff() {
        state = "OFF";
        power = 0.0;
    }

    string getState() const { return state; }
    float getEnergyUsed() const { return energy_used; }
    float getCycles() const { return cycles; }
    float getOnTime() const { return on_time; }
};

class Place {
protected:
    float room_temperature_off = 16.0;
    float room_temperature_init = 16.0;
    float ambient_room_rate = 0.7;
    bool hour_occupancy[24] = {false};
    int comfortOK = 0;
    int comfortBad = 0;
    Actuator fcu;

public:
    Place(float rate) : ambient_room_rate(rate) {}

    void simulate1Hr(int hour, float outdoorTemp, float chilledTemp) {
        float dT = outdoorTemp - room_temperature_init;
        room_temperature_off = room_temperature_init + ambient_room_rate * dT;

        if (hour_occupancy[hour]) { // Si hay ocupación
            fcu.turnOn(6.0); // Encendemos el FCU
            room_temperature_init = room_temperature_off + 0.5 * (chilledTemp - room_temperature_off);

            // Comprobar si la temperatura está dentro del rango de confort
            if (room_temperature_init >= 20 && room_temperature_init <= 24) {
                comfortOK++; // Si está en el rango de confort, marcamos ComfortOK
                comfortBad = 0; // Resetear ComfortBAD al lograr confort
                fcu.turnOff(); // Apagar el FCU cuando logremos el confort
            } else {
                comfortBad++; // Si está fuera del rango de confort, marcamos ComfortBAD
                // Intentamos corregir la temperatura (enciende el aire acondicionado hasta que se logre el confort)
                while (room_temperature_init > 24.0 || room_temperature_init < 20.0) {
                    fcu.turnOn(6.0); // Volver a encender el aire acondicionado para bajar la temperatura
                    room_temperature_init -= 0.5; // Disminuir la temperatura
                    if (room_temperature_init >= 20 && room_temperature_init <= 24) {
                        comfortOK++; // Cuando logre confort, marca como ComfortOK
                        comfortBad = 0; // Resetear ComfortBAD porque se ha corregido
                        break;
                    }
                }
            }
        } else {
            fcu.turnOff(); // Si no hay ocupación, apagamos el FCU
            room_temperature_init = room_temperature_off;
        }

        fcu.simulate1Hr();
    }

    void setOccupancy(const bool occupancy[24]) {
        for (int i = 0; i < 24; ++i) hour_occupancy[i] = occupancy[i];
    }

    void printHourStatus(const string &name, int hour) const {
        cout << name << ":\n"
             << "  ComfortOK: " << comfortOK << ", ComfortBAD: " << comfortBad << "\n"
             << "  Fan&Coil Unit: State: " << fcu.getState()
             << ", Energy: " << fixed << setprecision(2) << fcu.getEnergyUsed()
             << ", Cycles: " << fcu.getCycles()
             << ", Time: " << fcu.getOnTime() << "\n"
             << "  Room Temperature: " << fixed << setprecision(2) << room_temperature_init << "\n";
    }
};

int main() {
    // Configuración inicial de ocupación
    bool classroom1Occupancy[24] = {false, false, false, false, false, false, false, false, false, true,
                                    true, true, true, true, true, true, true, true, false, false,
                                    false, false, false, false};
    bool classroom2Occupancy[24] = {false, false, false, false, false, false, true, true, true, true,
                                    true, true, true, true, true, true, true, true, true, true,
                                    true, false, false, false};
    bool libraryOccupancy[24] = {false, false, false, false, false, false, true, true, true, true,
                                 true, true, false, false, true, true, true, true, true, true,
                                 false, false, false, false};

    Place classroom1(0.7), classroom2(0.7), library(0.9);
    classroom1.setOccupancy(classroom1Occupancy);
    classroom2.setOccupancy(classroom2Occupancy);
    library.setOccupancy(libraryOccupancy);

    float chilledWaterTemp = 8.0;

    // Simulación de 24 horas
    for (int hour = 0; hour < 24; ++hour) {
        cout << "Hour: " << setw(2) << hour << "\n";

        classroom1.simulate1Hr(hour, 30.0, chilledWaterTemp);
        classroom2.simulate1Hr(hour, 30.0, chilledWaterTemp);
        library.simulate1Hr(hour, 30.0, chilledWaterTemp);

        classroom1.printHourStatus("Aulas 1", hour);
        classroom2.printHourStatus("Aulas 2", hour);
        library.printHourStatus("Biblioteca", hour);
        cout << "---------------------------------------------\n";
    }

    // Resumen final a las 24:00 hrs
    cout << "at 24:00 hrs\n";
    classroom1.printHourStatus("Aulas 1", 24);
    classroom2.printHourStatus("Aulas 2", 24);
    library.printHourStatus("Biblioteca", 24);

    return 0;
}
